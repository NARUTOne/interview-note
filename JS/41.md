# P44

> ç¼–ç¨‹é¢˜

**âš¡é¢˜ç›®**:

â“ å†™ä¸€ä¸ªæ•°ç»„å»é‡å‡½æ•°

- å¦‚ä¼ å…¥çš„æ•°ç»„å…ƒç´ ä¸º`[123, "meili", "123", "mogu", 123]`ï¼Œåˆ™è¾“å‡ºï¼š`[123, "meili", "123", "mogu"]`

- å¦‚ä¼ å…¥çš„æ•°ç»„å…ƒç´ ä¸º`[123, [1, 2, 3], [1, "2", 3], [1, 2, 3], "meili"]`ï¼Œåˆ™è¾“å‡ºï¼š`[123, [1, 2, 3], [1, "2", 3], "meili"]`

- å¦‚ä¼ å…¥çš„æ•°ç»„å…ƒç´ ä¸º`[123, {a: 1}, {a: {b: 1}}, {a: "1"}, {a: {b: 1}}, "meili"]`ï¼Œåˆ™è¾“å‡ºï¼š`[123, {a: 1}, {a: {b: 1}}, {a: "1"}, "meili"]`

## ä¼˜è§£ ğŸ”¥

> ä¸è€ƒè™‘ undefinedï¼Œ å¯¹è±¡å±æ€§é¡ºåºä¸åŒ æƒ…å†µ, åˆ¤æ–­å­—ç¬¦ä¸²ç›¸ç­‰

```js
arr.map(JSON.stringify).filter((v, k, arr) => arr.indexOf(v) === k).map(JSON.parse)
```

> ES6+æ–°ç‰¹æ€§

```js
function removeRepeat(arr) {
  const map = new Map();
  
  // å…ˆç”¨ Set è¿‡æ»¤ä¸€æ³¢ï¼Œè¿‡æ»¤æ‰é‡å¤çš„åŸºæœ¬ç±»å‹
  return [...new Set(arr)].filter(item => {
    // è¿™é‡Œç°åœ¨åªå‰©ä¸‹å¼•ç”¨ç±»å‹äº†
    // æŠŠå¼•ç”¨ç±»å‹è½¬ä¸º stringï¼Œä½œä¸º Map çš„é”®å
    const key = JSON.stringify(item);
    // åˆ¤æ–­æ˜¯å¦æœ‰æ­¤é”®å
    if (!map.has(key)) {
      map.set(key, true);
      return true;
    }
  });
}

const test = [
  {
    it:     [123, "meili", "123", "mogu", 123],
    expect: [123, "meili", "123", "mogu"]
  }, {
    it:     [123, [1, 2, 3], [1, "2", 3], [1, 2, 3], "meili"],
    expect: [123, [1, 2, 3], [1, "2", 3], "meili"]
  }, {
    it:     [123, {a: 1}, {a: {b: 1}}, {a: "1"}, {a: {b: 1}}, "meili"],
    expect: [123, {a: 1}, {a: {b: 1}}, {a: "1"}, "meili"]
  }
];

test.map(item => {
  const result = removeRepeat(item.it);
  const isPassed = JSON.stringify(result) === JSON.stringify(item.expect);

  console.group(result);
  isPassed ? console.log('%câˆš Pass', 'color: green') :
    console.log('%cÃ— Failed', 'color: red');
  console.groupEnd();
});
```

## åˆ†æ

**é—®é¢˜å®é™…ä¸Šæ˜¯ä¸€ä¸ªå»é‡é—®é¢˜ï¼Œåœ¨ === çš„åŸºç¡€ä¸Šæ–°å¢å¦‚ä¸‹ä¸¤æ¡è§„åˆ™**ï¼š

- è§„åˆ™1ï¼šå¦‚æœæ˜¯æ•°ç»„ åˆ™æ¯ä¸ªå…ƒç´ ç›¸ç­‰è®¤ä¸ºä¸¤ä¸ªæ•°ç»„ç›¸ç­‰
- è§„åˆ™2ï¼šå¦‚æœæ˜¯å¯¹è±¡ åˆ™æ¯ä¸ªé”®çš„å€¼éƒ½ç›¸ç­‰åˆ™è®¤ä¸ºä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰

å»é‡æœ¬èº«å°±æ˜¯éå†æ•°ç»„æ¯”è¾ƒè€Œå·²ï¼Œå› æ­¤é‡ç‚¹æ˜¯å®ç°å«æœ‰ä»¥ä¸Šä¸¤æ¡æ‰©å±•è§„åˆ™çš„æ¯”è¾ƒå‡½æ•°ã€‚

**å®ç°æ¯”è¾ƒå‡½æ•°æ€è·¯**ï¼š

- åˆ¤æ–­å‡½æ•°ä¸­é¦–å…ˆè·å–ç±»å‹ï¼Œè‹¥ç±»å‹ä¸ç­‰ï¼Œåˆ™è¿™ä¸¤ä¸ªå€¼ä¸ç›¸ç­‰ï¼Œè‹¥ç±»å‹ç›¸åŒï¼Œç»§ç»­æ¯”è¾ƒã€‚
- å¦‚æœéƒ½ä¸ºæ•°ç»„ï¼Œéå†æ•°ç»„ï¼Œæ¯”è¾ƒæ¯ä¸ªæˆå‘˜ï¼Œæ¯”è¾ƒæ–¹æ³•ä¸ºå½“å‰æ–¹æ³•ã€‚
- å¦‚æœéƒ½ä¸ºå¯¹è±¡ï¼Œéå†å¯¹è±¡é”®åï¼Œæ¯”è¾ƒå¯¹åº”é”®å€¼æ˜¯å¦ç›¸ç­‰ï¼Œæ¯”è¾ƒæ–¹æ³•ä¸ºå½“å‰æ–¹æ³•ã€‚
- å…¶ä»–æƒ…å†µç›´æ¥ä½¿ç”¨ === æ¯”è¾ƒã€‚

**å»é‡æ€è·¯**ï¼š

- å¯¹è¾“å…¥æ•°ç»„ä½¿ç”¨ reduce æ–¹æ³•éå†ï¼Œä¼ é€’åˆå§‹ç´¯è®¡å€¼ä¸º []
- reduce å›è°ƒå‡½æ•°ä¸­å¯¹å½“å‰ç´¯è®¡å€¼ä½¿ç”¨ some æ–¹æ³•æ£€æŸ¥å½“å‰å…ƒç´ æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™åŠ å…¥å³å¯ã€‚
- å®Œæˆ reduce éå†åç´¯è®¡å€¼å³ä¸ºå»é‡åçš„æ•°ç»„ã€‚

ä»£ç å®ç°

```js
// è¾…åŠ©å‡½æ•° ç”¨äºç±»å‹è·å–
var getType = (function() {
    const class2type = { '[object Boolean]': 'boolean', '[object Number]': 'number', '[object String]': 'string', '[object Function]': 'function', '[object Array]': 'array', '[object Date]': 'date', '[object RegExp]': 'regexp', '[object Object]': 'object', '[object Error]': 'error', '[object Symbol]': 'symbol' };

    return function getType(obj) {
        if (obj == null) {
            return obj + '';
        }
        const str = Object.prototype.toString.call(obj);
        return typeof obj === 'object' || typeof obj === 'function' ? class2type[str] || 'object' : typeof obj;
    };
})();

/**
 * åˆ¤æ–­ä¸¤ä¸ªå…ƒç´ æ˜¯å¦ç›¸ç­‰
 * åœ¨ === çš„åŸºç¡€ä¸Š æœ‰å¦‚ä¸‹æ‰©å±•è§„åˆ™
 * è§„åˆ™1ï¼šå¦‚æœæ˜¯æ•°ç»„ åˆ™æ¯ä¸ªå…ƒç´ ç›¸ç­‰è®¤ä¸ºä¸¤ä¸ªæ•°ç»„ç›¸ç­‰
 * è§„åˆ™2ï¼šå¦‚æœæ˜¯å¯¹è±¡ åˆ™æ¯ä¸ªé”®çš„å€¼éƒ½ç›¸ç­‰åˆ™è®¤ä¸ºä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰
 * @param {any} target æ¯”è¾ƒå…ƒç´ 
 * @param {any} other å…¶ä»–å…ƒç´ 
 * @returns {Boolean} æ˜¯å¦ç›¸ç­‰
 */
function isEqual(target, other) {
    const t1 = getType(target);
    const t2 = getType(other);

    // ç±»å‹ä¸åŒ
    if (t1 !== t2) return false;

    if (t1 === 'array') {
        if (target.length !== other.length) return false; // æ•°ç»„é•¿åº¦ä¸ç­‰
        // æ¯”è¾ƒå½“å‰æ•°ç»„å’Œå¦ä¸€ä¸ªæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ 
        return target.every((item, i) => {
            // return item === target;
            return isEqual(item, other[i]);
        });
    }

    if (t2 === 'object') {
        // å¯¹è±¡æƒ…å†µç±»ä¼¼æ•°ç»„ ä½†æ˜¯éå†æ–¹æ³•åŒºåˆ«ä¸€ä¸‹
        const keysArr = Object.keys(target);
        if (keysArr.length !== Object.keys(other).length) return false;
        return keysArr.every(k => {
            return isEqual(target[k], other[k]);
        });
    }

    return target === other;
}

/**
 * å¯¹è¾“å…¥æ•°ç»„æŒ‰ç…§æŒ‡å®šè§„åˆ™è¿›è¡Œå»é‡
 *
 * @param {Array<any>} arr å¾…å»é‡çš„æ•°ç»„
 * @returns {Array<any>} å»é‡åçš„æ–°æ•°ç»„
 */
function unique(arr) {
    return arr.reduce((outputArr, current) => {
        const isUnique = !outputArr.some(item => isEqual(current, item));
        if (isUnique) {
            outputArr.push(current);
        }
        return outputArr;
    }, []);
}
```
