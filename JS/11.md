# P11

> JS ä¸­ thisç»‘å®š

**âš¡é¢˜ç›®**:

â“ å®ç° bind, call, apply

## ä¼˜è§£ ğŸ”¥

> apply å®ç°

```js
Function.prototype.myApply = function (context) {
  var context = context || window
  context.fn = this

  var result
  // éœ€è¦åˆ¤æ–­æ˜¯å¦å­˜å‚¨ç¬¬äºŒä¸ªå‚æ•°
  // å¦‚æœå­˜åœ¨ï¼Œå°±å°†ç¬¬äºŒä¸ªå‚æ•°å±•å¼€
  if (arguments[1]) {
    result = context.fn(...arguments[1])
  } else {
    result = context.fn()
  }

  delete context.fn
  return result
}
```

> call å®ç°

```js
Function.prototype.myCall = function (context) {
  var context = context || window
  // ç»™ context æ·»åŠ ä¸€ä¸ªå±æ€§
  // getValue.call(a, 'yck', '24') => a.fn = getValue
  context.fn = this
  // å°† context åé¢çš„å‚æ•°å–å‡ºæ¥
  var args = [...arguments].slice(1)
  // getValue.call(a, 'yck', '24') => a.fn('yck', '24')
  var result = context.fn(...args)
  // åˆ é™¤ fn
  delete context.fn
  return result
}
```

> bind å®ç°

```js
/**
  * ! bindæ¨¡æ‹Ÿå®ç°
  * ? thisæŒ‡å‘æ”¹å˜ï¼Œä¼ å‚ä¸æ‰§è¡Œ
  * * åŸç†ï¼šapply/call
  */

Function.prototype.bind = function (obj, arg) {
  var arg = Array.prototype.slice.call(arguments, 1);
  var context = this;
  var F =  function () {}  // åœ¨newä¸€ä¸ªbindä¼šç”Ÿæˆæ–°å‡½æ•°ï¼Œå¿…é¡»çš„æ¡ä»¶å°±æ˜¯è¦ç»§æ‰¿åŸå‡½æ•°çš„åŸå‹ï¼Œå› æ­¤ç”¨åˆ°å¯„ç”Ÿç»§æ‰¿æ¥å®Œæˆæˆ‘ä»¬çš„è¿‡ç¨‹
  var bound = function (newArg) {
    arg = arg.concat(Array.prototype.slice.call(newArg));
    return context.apply(this instanceof  F ?ã€€this : obj || window, arg)
  }
  
  F.prototype = context.prototype;
  bound.prototype = new F();
  return bound;
}

var test = function(a,b){
  console.log('ä½œç”¨åŸŸç»‘å®š '+ this.value)
  console.log('bindå‚æ•°ä¼ é€’ '+ a.value2)
  console.log('è°ƒç”¨å‚æ•°ä¼ é€’ ' + b)
}
var obj = {
  value:'ok'
}
var fun_new = test.bind(obj,{value2:'also ok'})

fun_new ('hello bind')

var new_fun = new fun_new('hello bind'); // æ„é€ å‡½æ•°
```
