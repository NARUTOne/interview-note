# æ·±æ‹·è´

> JS æ·±æ‹·è´ï¼›æ·±åº¦ä¼˜å…ˆï¼Œå¹¿åº¦ä¼˜å…ˆ

**âš¡é¢˜ç›®**:

â“ è¯·åˆ†åˆ«ç”¨æ·±åº¦ä¼˜å…ˆæ€æƒ³å’Œå¹¿åº¦ä¼˜å…ˆæ€æƒ³å®ç°ä¸€ä¸ªæ‹·è´å‡½æ•°

## ä¼˜è§£ ğŸ”¥

å·¥å…·æ–¹æ³•

```js
// å·¥å…·å‡½æ•°
let _toString = Object.prototype.toString
let map = {
  array: 'Array',
  object: 'Object',
  function: 'Function',
  string: 'String',
  null: 'Null',
  undefined: 'Undefined',
  boolean: 'Boolean',
  number: 'Number'
}
let getType = (item) => {
  return _toString.call(item).slice(8, -1)
}
let isTypeOf = (item, type) => {
  return map[type] && map[type] === getType(item)
}
```

æ·±åº¦ä¼˜å…ˆæ·±æ‹·è´

```js
// visitedArr ç¼“å­˜æ‹·è´
let DFSdeepClone = (obj, visitedArr = []) => {
  let _obj = {}
  if (isTypeOf(obj, 'array') || isTypeOf(obj, 'object')) {
    let index = visitedArr.indexOf(obj)
    _obj = isTypeOf(obj, 'array') ? [] : {}
    if (~index) { // åˆ¤æ–­ç¯çŠ¶æ•°æ®ï¼Œ ~æŒ‰ä½é
      _obj = visitedArr[index]
    } else {
      visitedArr.push(obj)
      for (let item in obj) {
        _obj[item] = DFSdeepClone(obj[item], visitedArr)
      }
    }
  } else if (isTypeOf(obj, 'function')) {
    _obj = eval('(' + obj.toString() + ')');
  } else {
    _obj = obj
  }
  return _obj
}
```

å¹¿åº¦ä¼˜å…ˆæ·±æ‹·è´

```js
let BFSdeepClone = (obj) => {
    let origin = [obj],
      copyObj = {},
      copy = [copyObj]
      // å»é™¤ç¯çŠ¶æ•°æ®
    let visitedQueue = [],
      visitedCopyQueue = []
    while (origin.length > 0) {
      let items = origin.shift(),
        _obj = copy.shift()
      visitedQueue.push(items)
      if (isTypeOf(items, 'object') || isTypeOf(items, 'array')) {
        for (let item in items) {
          let val = items[item]
          if (isTypeOf(val, 'object')) {
            let index = visitedQueue.indexOf(val)
            if (!~index) {
              _obj[item] = {}
                //ä¸‹æ¬¡whileå¾ªç¯ä½¿ç”¨ç»™ç©ºå¯¹è±¡æä¾›æ•°æ®
              origin.push(val)
                // æ¨å…¥å¼•ç”¨å¯¹è±¡
              copy.push(_obj[item])
            } else {
              _obj[item] = visitedCopyQueue[index]
              visitedQueue.push(_obj)
            }
          } else if (isTypeOf(val, 'array')) {
            // æ•°ç»„ç±»å‹åœ¨è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªç©ºæ•°ç»„
            _obj[item] = []
            origin.push(val)
            copy.push(_obj[item])
          } else if (isTypeOf(val, 'function')) {
            _obj[item] = eval('(' + val.toString() + ')');
          } else {
            _obj[item] = val
          }
        }
        // å°†å·²ç»å¤„ç†è¿‡çš„å¯¹è±¡æ•°æ®æ¨å…¥æ•°ç»„ ç»™ç¯çŠ¶æ•°æ®ä½¿ç”¨
        visitedCopyQueue.push(_obj)
      } else if (isTypeOf(items, 'function')) {
        copyObj = eval('(' + items.toString() + ')');
      } else {
        copyObj = obj
      }
    }
  return copyObj
}
```

æµ‹è¯•

```js
/**æµ‹è¯•æ•°æ® */
// è¾“å…¥ å­—ç¬¦ä¸²String
// é¢„æœŸè¾“å‡ºString
let str = 'String'
var strCopy = DFSdeepClone(str)
var strCopy1 = BFSdeepClone(str)
console.log(strCopy, strCopy1) // String String æµ‹è¯•é€šè¿‡
// è¾“å…¥ æ•°å­— -1980
// é¢„æœŸè¾“å‡ºæ•°å­— -1980
let num = -1980
var numCopy = DFSdeepClone(num)
var numCopy1 = BFSdeepClone(num)
console.log(numCopy, numCopy1) // -1980 -1980 æµ‹è¯•é€šè¿‡
// è¾“å…¥boolç±»å‹
// é¢„æœŸè¾“å‡ºboolç±»å‹
let bool = false
var boolCopy = DFSdeepClone(bool)
var boolCopy1 = BFSdeepClone(bool)
console.log(boolCopy, boolCopy1) //false false æµ‹è¯•é€šè¿‡
// è¾“å…¥ null
// é¢„æœŸè¾“å‡º null
let nul = null
var nulCopy = DFSdeepClone(nul)
var nulCopy1 = BFSdeepClone(nul)
console.log(nulCopy, nulCopy1) //null null æµ‹è¯•é€šè¿‡

// è¾“å…¥undefined
// é¢„æœŸè¾“å‡ºundefined
let und = undefined
var undCopy = DFSdeepClone(und)
var undCopy1 = BFSdeepClone(und)
console.log(undCopy, undCopy1) //undefined undefined æµ‹è¯•é€šè¿‡
  //è¾“å…¥å¼•ç”¨ç±»å‹obj
let obj = {
  a: 1,
  b: () => console.log(1),
  c: {
    d: 3,
    e: 4
  },
  f: [1, 2],
  und: undefined,
  nul: null
}
var objCopy = DFSdeepClone(obj)
var objCopy1 = BFSdeepClone(obj)
console.log(objCopy === objCopy1) // å¯¹è±¡ç±»å‹åˆ¤æ–­ false æµ‹è¯•é€šè¿‡
console.log(obj.c === objCopy.c) // å¯¹è±¡ç±»å‹åˆ¤æ–­ false æµ‹è¯•é€šè¿‡
console.log(obj.c === objCopy1.c) // å¯¹è±¡ç±»å‹åˆ¤æ–­ false æµ‹è¯•é€šè¿‡
console.log(obj.b === objCopy1.b) // å‡½æ•°ç±»å‹åˆ¤æ–­ false æµ‹è¯•é€šè¿‡
console.log(obj.b === objCopy.b) // å‡½æ•°ç±»å‹åˆ¤æ–­ false æµ‹è¯•é€šè¿‡
console.log(obj.f === objCopy.f) // æ•°ç»„ç±»å‹åˆ¤æ–­ false æµ‹è¯•é€šè¿‡
console.log(obj.f === objCopy1.f) // æ•°ç»„ç±»å‹åˆ¤æ–­ false æµ‹è¯•é€šè¿‡
console.log(obj.nul, obj.und) // è¾“å‡ºnullï¼Œundefined æµ‹è¯•é€šè¿‡

// è¾“å…¥ç¯çŠ¶æ•°æ®
// é¢„æœŸä¸çˆ†æ ˆä¸”æ·±åº¦å¤åˆ¶
let circleObj = {
  foo: {
    name: function() {
      console.log(1)
    },
    bar: {
      name: 'bar',
      baz: {
        name: 'baz',
        aChild: null //å¾…ä¼šè®©å®ƒæŒ‡å‘obj.foo
      }
    }
  }
}
circleObj.foo.bar.baz.aChild = circleObj.foo
var circleObjCopy = DFSdeepClone(circleObj)
var circleObjCopy1 = BFSdeepClone(circleObj)
console.log(circleObjCopy, circleObjCopy1) // æµ‹è¯•é€šè¿‡?
```
