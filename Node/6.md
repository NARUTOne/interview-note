# express or koa2

**âš¡é¢˜ç›®**:

â“ å¤šç»´åº¦åˆ†æ Expressã€Koa ä¹‹é—´çš„åŒºåˆ«

## ä¼˜è§£ ğŸ”¥

```js
// express
const app = express();

app.use((req, res, next) => {
  console.log(`url: ${req.url}, method: ${req.method}`);
  next();
})

// koa2
const app = new Koa();

// logger
app.use(async (ctx, next) => {
  console.log('ç¬¬ä¸€å±‚æ´‹è‘± - å¼€å§‹')
  await next(); // è¿›å…¥ç¬¬äºŒå±‚
  const rt = ctx.response.get('X-Response-Time');
  console.log(`${ctx.method} ${ctx.url} - ${rt}`);
  console.log('ç¬¬ä¸€å±‚æ´‹è‘± - ç»“æŸ')
});
```

**handleå¤„ç†æ–¹å¼**ï¼š

- express: ä½¿ç”¨æ™®é€šçš„å›è°ƒå‡½æ•°ï¼Œä¸€ç§çº¿æ€§çš„é€»è¾‘ï¼Œåœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸Šå®Œæˆæ‰€æœ‰çš„ HTTP è¯·æ±‚
ä¸€ç§ä¸èƒ½å®¹å¿çš„æ˜¯ `Callback`ï¼Œç‰¹åˆ«æ˜¯å¯¹é”™æ•è·å¤„ç†èµ·æ¥å¾ˆä¸å‹å¥½ï¼Œæ¯ä¸€ä¸ªå›è°ƒéƒ½æ‹¥æœ‰ä¸€ä¸ªæ–°çš„è°ƒç”¨æ ˆï¼Œå› æ­¤ä½ æ²¡æ³•å¯¹ä¸€ä¸ª callback åš try catch æ•è·ï¼Œä½ éœ€è¦åœ¨ Callback é‡Œåšé”™è¯¯æ•è·ï¼Œç„¶åä¸€å±‚ä¸€å±‚å‘å¤–ä¼ é€’ã€‚

- koa1: æ˜¯åˆ©ç”¨ `generator` å‡½æ•°ç”Ÿæˆå™¨ + co æ¥å®ç°çš„ â€œåç¨‹å“åº”â€

- koa2: ä½¿ç”¨ ES7 çš„ `Async/Await`æ›¿æ¢äº†åŸæ¥çš„ Generator + co çš„æ¨¡å¼ï¼Œä¹Ÿæ— éœ€å¼•å…¥ç¬¬ä¸‰æ–¹åº“ï¼Œåº•å±‚åŸç”Ÿæ”¯æŒï¼ŒAsync/Await ç°åœ¨ä¹Ÿç§°ä¸º JS å¼‚æ­¥çš„ç»ˆæè§£å†³æ–¹æ¡ˆã€‚

Koa ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªæ´‹è‘±æ¨¡å‹ï¼Œå®ƒçš„ä¸€ä¸ªç‰¹ç‚¹æ˜¯çº§è”ï¼Œé€šè¿‡ await next() æ§åˆ¶è°ƒç”¨ â€œä¸‹æ¸¸â€ ä¸­é—´ä»¶ï¼Œç›´åˆ° â€œä¸‹æ¸¸â€ æ²¡æœ‰ä¸­é—´ä»¶ä¸”å †æ ˆæ‰§è¡Œå®Œæ¯•ï¼Œæœ€ç»ˆåœ¨æµå› â€œä¸Šæ¸¸â€ ä¸­é—´ä»¶ã€‚è¿™ç§æ–¹å¼æœ‰ä¸ªä¼˜ç‚¹ç‰¹åˆ«æ˜¯å¯¹äºæ—¥å¿—è®°å½•ï¼ˆè¯·æ±‚->å“åº”è€—æ—¶ç»Ÿè®¡ï¼‰ã€é”™è¯¯å¤„ç†æ”¯æŒéƒ½å¾ˆå®Œç¾

**ä¸­é—´ä»¶æœºåˆ¶**ï¼š

- express: çº¿æ€§å›è°ƒæ‰§è¡Œ next
- koa2: æ´‹è‘±æ¨¡å¼ next

**å“åº”æœºåˆ¶**ï¼š

- express: req/reså¯¹è±¡å“åº”

expressè·å–å‚æ•°æ–¹å¼ï¼š

- req.query è·å–getè¯·æ±‚å‚æ•°

```js
app.get('/checkpostcode', function(req, res) {
  let postcode = req.query.postcode;
  if(postcode!=11111){
    return res.status(400).send({"msg":"invalid postcode"})
  }
  return res.status(200).send({"msg":"valid postcode"})
});
```

- req.params è·å–é€šè¿‡paramså‚æ•°ä¼ è¾“æ–¹å¼ï¼›å¤„ç† /:xxx å½¢å¼çš„ get è¯·æ±‚

```js
axios.get('/user', {
  params: {
    ID: 12345
  }
})
```

- req.body å¤„ç† post è¯·æ±‚, ä½¿ç”¨åŒ…å¤„ç†body-parser
`var username = req.body.username`


- koa: ctxå¯¹è±¡

koaè·å–å‚æ•°æ–¹å¼ï¼š

- ctx.request.body: éœ€è¦ä½¿ç”¨`koa-bodyparser`å¤„ç†postè¯·æ±‚å‚æ•°
- ctx.params è·å–åŠ¨æ€è·¯ç”±å‚æ•°

```js
router.get('/package/:aid/:cid',async (ctx)=>{
    //è·å–åŠ¨æ€è·¯ç”±çš„ä¼ å€¼
    console.log(ctx.params);  //{ aid: '123', cid: '456' }
    ctx.body="è¯¦æƒ…";
})
```
- ctx.request.query è·å–è§£æçš„æŸ¥è¯¢å­—ç¬¦ä¸², å½“æ²¡æœ‰æŸ¥è¯¢å­—ç¬¦ä¸²æ—¶ï¼Œè¿”å›ä¸€ä¸ªç©ºå¯¹è±¡

```js
// url?color=blue&size=small
{
  color: 'blue',
  size: 'small'
}
```
