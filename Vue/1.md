# P1

> Vue ä¸­çš„ åŒå‘æ•°æ®ç»‘å®š

**âš¡é¢˜ç›®**:

â“ èŠèŠ Vue çš„åŒå‘æ•°æ®ç»‘å®šï¼ŒModel å¦‚ä½•æ”¹å˜ Viewï¼ŒView åˆæ˜¯å¦‚ä½•æ”¹å˜ Model çš„ï¼Ÿ

## ä¼˜è§£ ğŸ”¥

![v-model](./imgs/v-model.jpg)

- ä» M åˆ° V çš„æ˜ å°„ï¼ˆData Bindingï¼‰ï¼Œè¿™æ ·å¯ä»¥å¤§é‡èŠ‚çœä½ äººè‚‰æ¥ update View çš„ä»£ç 
- ä» V åˆ° M çš„äº‹ä»¶ç›‘å¬ï¼ˆDOM Listenersï¼‰ï¼Œè¿™æ ·ä½ çš„ Model ä¼šéšç€ View è§¦å‘äº‹ä»¶è€Œæ”¹å˜

[v-model è‡ªå®šä¹‰ç»„ä»¶ç»“åˆ](https://juejin.im/post/5c77c53051882523f0267e18)

```html
<currency-input v-model="price"></currentcy-input>
<!--ä¸Šè¡Œä»£ç æ˜¯ä¸‹è¡Œçš„è¯­æ³•ç³–
  <currency-input :value="price" @input="price = arguments[0]"></currency-input>
-->
```

ç»™ç»„ä»¶æ·»åŠ  v-model å±æ€§æ—¶ï¼Œé»˜è®¤ä¼šæŠŠ value ä½œä¸ºç»„ä»¶çš„å±æ€§ï¼Œç„¶åæŠŠ 'input' å€¼ä½œä¸ºç»™ç»„ä»¶ç»‘å®šäº‹ä»¶æ—¶çš„äº‹ä»¶å

**Vue2.x**æ—¶ä»£

`Object.definedProperty`

```html
<input type="text" id='inp'>
<div id='view'></div>
<script>
    const input = document.getElementById('inp');
    const view = document.getElementById('view');

    let data = {
        // name: 'view'
        valueObj:{
            name:'view'
        }
    }

    function update() { //æ›´æ–°è§†å›¾
        view.innerText = data.valueObj.name;
    }

    input.oninput = function () { //æ›´æ–°æ•°æ® 
        data.valueObj.name = this.value
    }

    function observerData(obj) {
        if (!obj || typeof obj != 'object') return obj; //å®¹é”™ + é€’å½’å‡ºå£

        Object.keys(obj).forEach(key => {
            definedRective(obj, key, obj[key]);
        })
    }

    observerData(data);

    function definedRective(obj, key, val) {

        observerData(val); //æ·±å±‚æ•°æ®é€’å½’å¤„ç†

        Object.defineProperty(obj, key, {
            get() {
                return val;
            },
            set(newVal) {
                if (val === newVal) return; //ä¼˜åŒ–æ€§èƒ½
                val = newVal;
                update();
            }
        })
    }
</script>
```

- ä¸èƒ½ç›´æ¥ç›‘æ§æ•°ç»„ï¼Œè€Œæ˜¯é—´æ¥é‡å†™Array.prototypeä¸Šçš„æ•°ç»„æ–¹æ³•(å°±æ˜¯vueä¸­å¸¸å¸¸å¬è§çš„æ•°ç»„å˜å¼‚æ–¹æ³•)æ¯”å¦‚pushã€unshfit...å±æ€§,ç›‘å¬æ•°ç»„åŸå‹ä¸Šçš„è¿™äº›æ–¹æ³•,è¿›è€Œå®ç°æ›´æ–°
- å¦‚æœè¢«ç›‘å¬å¯¹è±¡åœ¨æ‰§è¡Œç›‘å¬ä¹‹ååˆé‡æ–°æ·»åŠ äº†å±æ€§,è¿™äº›å±æ€§å€¼åˆ™æ— æ³•ç›‘å¬åˆ°

**Vue3.x**å±•æœ›

`Proxy&Reflect`

```js
let oProxy = new Proxy(data, {
    get(target, key, receiver) {
        console.log(1)
        return Reflect.get(target, key);
    },
    set(target, key, newValue, receiver) {
        console.log(1)
        return Reflect.set(target, key, newValue)
    }
});
```
