# P2

> TCP链接

❓ TCP 三次握手和四次挥手的理解

## 优解 🚀

> [https://juejin.im/post/5c078058f265da611c26c235](https://juejin.im/post/5c078058f265da611c26c235)

![TCP链接](./TCP.png)

由于TCP连接是全双工的，因此每个方向都必须单独进行关闭，所以即使没有最后一个包，也需要先回复断开连接的请求，然后再发送关闭请求

### 三次握手

> 三次握手（Three-way Handshake）其实就是指建立一个TCP连接时，需要客户端和服务器总共发送3个包

**主要作用**就是为了确认双方的接收能力和发送能力是否正常、指定自己的初始化序列号为后面的可靠性传送做准备
**实质**其实就是连接服务器指定端口，建立TCP连接，并同步连接双方的序列号和确认号，交换TCP窗口大小信息

- 第一次：客户端 ——> 问询SYN报文 ——> 服务端
- 第二次：服务端 ——> 应答SYN报文 ——> 客户端
- 第三次：客户端 ——> ACK报文 ——> 服务端
- 建立连接状态

第三次握手的时候，是可以携带数据的。但是，第一次、第二次握手不可以携带数据

### 四次挥手

> 终止一个连接要经过四次挥手, 这由TCP的半关闭（half-close）造成的。所谓的半关闭，其实就是TCP提供了连接的一端在结束它的发送后还能接收来自另一端数据的能力。

- 第一次：客户端 ——> FIN报文 ——> 服务端
- 第二次：服务端 ——> ACK报文 ——> 客户端
- 第三次：服务端 ——> FIN报文 ——> 客户端
- 第四次：客户端 ——> ACK报文 ——> 服务端
